language: go
sudo: false
matrix:
  include:
    - go: 1.x
      env: GO111MODULE=on LATEST=true
    - go: 1.11.x
      env: GO111MODULE=on
    - go: tip
  allow_failures:
    - go: tip

before_install:
  - go get github.com/mitchellh/gox

install:
  - # skip

script:
  - go get -t -v ./...
  - diff -u <(echo -n) <(gofmt -d .)
  - go vet $(go list ./... | grep -v /vendor/)
  - if [ "${LATEST}" = "true" ]; then gox -os="linux" -arch="amd64 arm64 arm 386" -ldflags "-X main.Rev=`git rev-parse --short HEAD`" -verbose ./...; fi
  - if [ "${LATEST}" = "true" ]; then gox -os="darwin" -arch="amd64" -ldflags "-X main.Rev=`git rev-parse --short HEAD`" -verbose ./...; fi

before_deploy:
  # Set up git user name and tag this commit
  - git config --local user.name "mjohnsey"
  - git config --local user.email "mjohnsey@gmail.com"
  - export TRAVIS_TAG=${TRAVIS_TAG:-$(date +'%Y%m%d')-$(git log --format=%h -1)}
  - git tag $TRAVIS_TAG

deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: cLs1vOi5mnHxcI+iUdWuLmvesdu1Xa83RI0WqkJuaPkkB7MMFC0vl2qugn1DVf6OHakLU2hUXzK73nRXWurdbYpSttvBRBaAb9VNvx4rnkG8vsnyusmB4Pd1O52vlXbVQBUIJMxf0LyidhPaRWYeoPONJemekN95hCaY/V3+uzOVKwQZxfVqd8+2KVNjYZN7n/QGLKS4egl3j7I6jOA1XxxKjVlDYP33unYYrtXuPL8Mmr+NfmL+eRU1b+S54WMa7RU8VmVIAufrDwfbH8OqMg1afbNiCNntyY0rFAZE5Yq+RjF44Q907wRLd2dx58DJCo0hhpHgJ2gGpOp9j6Mn8gCPqiiv9XWkSGbQ7mgnz6seFmNoG5J03QVYdDN0RSpZ4G56xS7PkHI6rDjDulWS8kL84kjkOG5Nfe89CFQPAb9Jvyim9vzwcKt2p3aMSeHhqdPeDE0jpERFTqHj1pFR7nq2tysyWApr1A4i6fQQm4jOyegNTar6EZKTWXGJF6TIRaTssxVxwTO71R9eQIZ5NzRxc6M8KQyo3xBbBZWSz1amOXMlt2+KSEPv55NA/lHavtF+HC74nPD5J1U3e23HMFb0/zx4EucyA/KnlH9rHHC27Jo07YenVbYB0zugT4EYcmW6hqhtu8gqjWuw1eGliEW0Fuikr5PcIaCaizMo58Q=
  file:
      - go-time_darwin_amd64
      - go-time_linux_amd64
      - go-time_linux_arm
      - go-time_linux_arm64
      - go-time_linux_386
  on:
    repo: mjohnsey/go-time
    condition: $LATEST = true
    branch: master
